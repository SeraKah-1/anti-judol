<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kasino Harapan Kosong</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@900&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #1a1a2e;
        }
        .font-display {
            font-family: 'Playfair Display', serif;
        }
        .neon-text {
            color: #fff;
            text-shadow:
                0 0 7px #fff,
                0 0 10px #fff,
                0 0 21px #fff,
                0 0 42px #f09,
                0 0 82px #f09,
                0 0 92px #f09,
                0 0 102px #f09,
                0 0 151px #f09;
        }
        .btn-primary {
            background-color: #e94560;
            transition: all 0.2s ease-in-out;
        }
        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px #e94560;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left-color: #e94560;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .cockroach-arena {
            background-color: #2d2d54;
            border: 5px solid #16213e;
        }
        .dealer-comment {
            background-color: #0f3460;
            border-left: 5px solid #e94560;
        }
    </style>
</head>
<body class="text-white">

    <div id="app-container" class="w-full max-w-6xl mx-auto p-4 md:p-6">

        <!-- API Key Screen -->
        <div id="api-key-screen" class="max-w-xl mx-auto text-center bg-[#16213e] p-8 rounded-xl shadow-2xl">
            <h1 class="text-3xl font-display text-yellow-300 mb-4">Akses Eksklusif</h1>
            <p class="text-gray-300 mb-6">Kasino ini sangat spesial, sampai-sampai butuh kunci pribadi dari Google AI untuk memastikan hanya orang "pintar" yang bisa masuk. Masukkan API Key-mu.</p>
            <input type="password" id="api-key-input" class="w-full bg-gray-900 text-white p-3 rounded-md border border-gray-600 focus:ring-2 focus:ring-yellow-400 focus:outline-none" placeholder="Masukkan API Key di sini...">
            <button id="save-api-key-btn" class="mt-4 w-full btn-primary text-white font-bold py-3 px-4 rounded-lg text-lg">Masuk ke Sarang Kehancuran</button>
        </div>

        <!-- Quiz Selection Screen -->
        <div id="quiz-selection-screen" class="hidden max-w-xl mx-auto text-center">
            <h1 class="text-3xl font-display text-yellow-300 mb-2">Isi Ulang Modal Intelektual</h1>
            <p class="text-gray-300 mb-6">Kamu tidak bisa membeli chip di sini. Kamu harus mendapatkannya dengan membuktikan kamu tidak sebodoh itu. Pilih topik kuis:</p>
            <div class="space-y-4 bg-[#16213e] p-8 rounded-xl shadow-2xl">
                <div>
                    <label for="topic-input" class="block mb-2 font-semibold text-lg text-left">Ketik Topik Apapun:</label>
                    <input type="text" id="topic-input" class="w-full bg-gray-900 text-white p-3 rounded-md border border-gray-600 focus:ring-2 focus:ring-yellow-400 focus:outline-none" placeholder="Contoh: Sejarah Romawi, Relativitas Einstein, Cara Memasak Indomie...">
                </div>
                <button id="start-quiz-btn" class="w-full btn-primary text-white font-bold py-3 px-4 rounded-lg text-lg">Mulai Kuis</button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden max-w-2xl mx-auto">
            <h2 id="quiz-title" class="text-2xl font-bold text-center mb-6"></h2>
            <div id="question-container" class="bg-[#16213e] p-8 rounded-xl shadow-2xl"></div>
            <div id="quiz-feedback" class="mt-4 text-center font-bold"></div>
        </div>
        
        <!-- Loading Screen -->
        <div id="loading-screen" class="hidden text-center p-10">
            <div class="flex justify-center items-center mb-4">
                <div class="spinner"></div>
            </div>
            <p id="loading-text" class="text-xl font-semibold text-gray-300"></p>
        </div>

        <!-- Casino Screen -->
        <div id="casino-screen" class="hidden">
            <div class="text-center mb-6">
                <h1 class="text-5xl font-display neon-text">Kasino Harapan Kosong</h1>
                <p class="text-gray-400">Tempat di mana chip hasil jerih payahmu akan kami ambil dengan senang hati.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Game Area -->
                <div class="lg:col-span-2 bg-[#16213e] p-6 rounded-xl shadow-2xl">
                    <h2 class="text-2xl font-bold text-center mb-4">Tebak Arah Kecoak&trade;</h2>
                    <div class="cockroach-arena w-full h-64 md:h-80 relative flex items-center justify-center rounded-lg mb-4">
                        <img id="cockroach-img" src="https://placehold.co/100x100/3d3d6b/ffffff?text=%F0%9F%A6%B3" alt="Kecoak Digital" class="w-24 h-24 transition-transform duration-500">
                    </div>
                    <div class="grid grid-cols-3 gap-2 items-center">
                        <div></div>
                        <button class="direction-btn btn-primary p-4 font-bold" data-direction="Utara">UTARA</button>
                        <div></div>
                        <button class="direction-btn btn-primary p-4 font-bold" data-direction="Barat">BARAT</button>
                        <div class="text-center">
                            <label for="bet-amount" class="block text-sm mb-1">Jumlah Taruhan:</label>
                            <input type="number" id="bet-amount" class="w-full bg-gray-900 text-center p-2 rounded" value="10">
                        </div>
                        <button class="direction-btn btn-primary p-4 font-bold" data-direction="Timur">TIMUR</button>
                        <div></div>
                        <button class="direction-btn btn-primary p-4 font-bold" data-direction="Selatan">SELATAN</button>
                        <div></div>
                    </div>
                </div>

                <!-- Player & Dealer Area -->
                <div>
                    <div class="bg-[#16213e] p-6 rounded-xl shadow-2xl mb-6">
                        <h3 class="text-xl font-bold mb-2">Status Pemain</h3>
                        <p class="text-3xl font-bold text-yellow-300"><span id="chip-count">0</span> Chips</p>
                        <p class="text-sm text-gray-400">Hasil dari kecerdasanmu (untuk saat ini).</p>
                        <button id="back-to-quiz-btn" class="w-full mt-4 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-3 rounded-lg">Cari Chip Lagi</button>
                    </div>
                    <div class="bg-[#16213e] p-6 rounded-xl shadow-2xl">
                        <h3 class="text-xl font-bold mb-2">Komentar Bandar</h3>
                        <div id="dealer-comment-box" class="dealer-comment p-4 rounded min-h-[100px] italic text-gray-300">
                            "Selamat datang, calon donatur. Silakan pilih arah kehancuran finansialmu."
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bankruptcy Screen -->
        <div id="bankruptcy-screen" class="hidden max-w-2xl mx-auto text-center bg-red-900 bg-opacity-50 p-8 rounded-xl shadow-2xl border-2 border-red-500">
            <h1 class="text-4xl font-display text-red-400 mb-4">MODAL INTELEKTUAL BANGKRUT</h1>
            <p class="text-gray-200 mb-6" id="bankruptcy-comment">Sang Bandar menatapmu dengan tatapan kasihan yang dibuat-buat. "Yah, setidaknya kamu sudah mencoba. Otak dan keberuntungan memang jarang akur."</p>
            <h3 class="font-bold text-lg mt-8 mb-4">Paket Stimulus Kebangkrutan:</h3>
            <div class="space-y-3 text-left">
                <a href="https://en.wikipedia.org/wiki/Gambler%27s_fallacy" target="_blank" class="block p-3 bg-gray-700 hover:bg-gray-600 rounded">Baca tentang "Gambler's Fallacy" (biar makin ngerasa bodoh)</a>
                <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank" class="block p-3 bg-gray-700 hover:bg-gray-600 rounded">Video kompilasi orang gagal (untuk menemani penderitaanmu)</a>
                <button id="restart-from-quiz-btn" class="w-full btn-primary p-3 rounded mt-4">Coba jadi pintar lagi dari awal...</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let apiKey = localStorage.getItem('satireCasinoApiKey');
        let gameState = {
            chips: 0,
            currentQuiz: [],
            currentQuestionIndex: 0,
        };

        const screens = {
            apiKey: document.getElementById('api-key-screen'),
            quizSelection: document.getElementById('quiz-selection-screen'),
            quiz: document.getElementById('quiz-screen'),
            loading: document.getElementById('loading-screen'),
            casino: document.getElementById('casino-screen'),
            bankruptcy: document.getElementById('bankruptcy-screen'),
        };

        const showScreen = (screenName) => {
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            screens[screenName].classList.remove('hidden');
        };

        const callAI = async (prompt, loadingText) => {
            document.getElementById('loading-text').textContent = loadingText;
            showScreen('loading');
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const data = await response.json();
                const textResponse = data.candidates[0].content.parts[0].text;
                const cleanedJsonString = textResponse.replace(/^```json\s*/, '').replace(/\s*```$/, '');
                return JSON.parse(cleanedJsonString);
            } catch (error) {
                console.error("AI Call Failed:", error);
                alert("Koneksi ke AI gagal. Periksa API Key atau coba lagi.");
                showScreen('apiKey'); // Fallback to API key screen
                return null;
            }
        };

        const handleApiKey = () => {
            const apiKeyInput = document.getElementById('api-key-input');
            const saveApiKeyBtn = document.getElementById('save-api-key-btn');
            saveApiKeyBtn.addEventListener('click', () => {
                const key = apiKeyInput.value.trim();
                if (key) {
                    apiKey = key;
                    localStorage.setItem('satireCasinoApiKey', key);
                    showScreen('quizSelection');
                } else { alert("API Key tidak boleh kosong."); }
            });
            if (apiKey) showScreen(gameState.chips > 0 ? 'casino' : 'quizSelection');
            else showScreen('apiKey');
        };

        const startQuiz = async () => {
            const topic = document.getElementById('topic-input').value.trim();
            if (!topic) {
                alert("Tolong masukkan topik kuis.");
                return;
            }
            const prompt = `
                Generate 5 multiple-choice quiz questions about "${topic}".
                You MUST respond with ONLY a valid JSON object.
                The structure must be: { "topic": "string", "questions": [ { "question": "string", "options": ["string", "string", "string", "string"], "answer": "string" } ] }.
                The answer must be one of the options.
            `;
            const result = await callAI(prompt, "AI sedang membuat soal-soal sulit untukmu...");
            if (result && result.questions) {
                gameState.currentQuiz = result.questions;
                gameState.currentQuestionIndex = 0;
                document.getElementById('quiz-title').textContent = `Kuis: ${result.topic}`;
                displayQuestion();
                showScreen('quiz');
            }
        };

        const displayQuestion = () => {
            const container = document.getElementById('question-container');
            const feedback = document.getElementById('quiz-feedback');
            container.innerHTML = '';
            feedback.innerHTML = '';
            
            if (gameState.currentQuestionIndex >= gameState.currentQuiz.length) {
                container.innerHTML = `<p class="text-center text-lg">Kuis selesai! Kamu berhasil mengumpulkan ${gameState.chips} chip. Sekarang, pergilah ke kasino dan habiskan semuanya.</p>`;
                const button = document.createElement('button');
                button.textContent = 'Masuk Kasino';
                button.className = 'w-full btn-primary text-white font-bold py-3 px-4 rounded-lg text-lg mt-4';
                button.onclick = () => showScreen('casino');
                container.appendChild(button);
                return;
            }

            const q = gameState.currentQuiz[gameState.currentQuestionIndex];
            container.innerHTML += `<p class="text-lg mb-4">${q.question}</p>`;
            const optionsGrid = document.createElement('div');
            optionsGrid.className = 'grid grid-cols-1 md:grid-cols-2 gap-3';
            q.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'p-3 bg-gray-700 hover:bg-gray-600 rounded-lg text-left';
                button.onclick = () => checkAnswer(option, q.answer);
                optionsGrid.appendChild(button);
            });
            container.appendChild(optionsGrid);
        };

        const checkAnswer = (selected, correct) => {
            const feedback = document.getElementById('quiz-feedback');
            if (selected === correct) {
                gameState.chips += 10;
                feedback.textContent = "+10 Chips! Jawabanmu benar. Jangan senang dulu.";
                feedback.className = "mt-4 text-center font-bold text-green-400";
            } else {
                feedback.textContent = "Salah! Jawaban yang benar adalah: " + correct;
                feedback.className = "mt-4 text-center font-bold text-red-400";
            }
            updateChipDisplay();
            gameState.currentQuestionIndex++;
            setTimeout(displayQuestion, 2000);
        };

        const updateChipDisplay = () => {
            document.getElementById('chip-count').textContent = gameState.chips;
        };

        const handleGambling = async (direction) => {
            const betAmount = parseInt(document.getElementById('bet-amount').value);
            if (isNaN(betAmount) || betAmount <= 0) {
                alert("Jumlah taruhan tidak valid.");
                return;
            }
            if (betAmount > gameState.chips) {
                alert("Chip-mu tidak cukup. Jawab kuis lagi sana!");
                return;
            }

            document.querySelectorAll('.direction-btn').forEach(b => b.disabled = true);
            
            const directions = ["Utara", "Selatan", "Timur", "Barat"];
            const result = directions[Math.floor(Math.random() * directions.length)];
            
            const cockroachImg = document.getElementById('cockroach-img');
            let transform = '';
            if (result === 'Utara') transform = 'translateY(-50px) rotate(0deg)';
            if (result === 'Selatan') transform = 'translateY(50px) rotate(180deg)';
            if (result === 'Barat') transform = 'translateX(-50px) rotate(-90deg)';
            if (result === 'Timur') transform = 'translateX(50px) rotate(90deg)';
            cockroachImg.style.transform = transform;

            let outcome;
            if (direction === result) {
                gameState.chips += betAmount;
                outcome = 'menang';
            } else {
                gameState.chips -= betAmount;
                outcome = 'kalah';
            }
            
            const prompt = `
                You are a sarcastic, passive-aggressive, and condescending casino dealer AI.
                The player just played a game called "Guess the Cockroach Direction".
                - Player's bet: ${betAmount} chips.
                - Player's choice: ${direction}.
                - Actual outcome: ${result}.
                - Result: The player ${outcome}.
                - Player's current chip count: ${gameState.chips}.
                
                Your task is to provide a short, snarky, and insulting comment based on this result in Bahasa Indonesia.
                You MUST respond with ONLY a valid JSON object with a single key: "comment".
                Example: { "comment": "Tentu saja kamu kalah. Kecoak itu bahkan lebih pintar darimu." }
            `;
            
            const dealerResponse = await callAI(prompt, "Bandar sedang memikirkan cara terbaik untuk menghinamu...");
            if (dealerResponse && dealerResponse.comment) {
                document.getElementById('dealer-comment-box').textContent = `"${dealerResponse.comment}"`;
            }

            setTimeout(() => {
                cockroachImg.style.transform = 'translate(0,0) rotate(0deg)';
                updateChipDisplay();
                if (gameState.chips <= 0) {
                    showBankruptcy();
                }
                document.querySelectorAll('.direction-btn').forEach(b => b.disabled = false);
            }, 2000);
        };

        const showBankruptcy = async () => {
            const prompt = `
                You are a sarcastic casino dealer AI. The player has just lost all their chips and is now bankrupt.
                Give them one last insulting comment for the bankruptcy screen in Bahasa Indonesia.
                Respond with a JSON object: { "comment": "string" }
            `;
            const finalComment = await callAI(prompt, "Menyiapkan paket kebangkrutan...");
            if (finalComment && finalComment.comment) {
                document.getElementById('bankruptcy-comment').textContent = `Sang Bandar menatapmu dengan tatapan kasihan yang dibuat-buat. "${finalComment.comment}"`;
            }
            showScreen('bankruptcy');
        };
        
        // --- Event Listeners ---
        document.getElementById('start-quiz-btn').addEventListener('click', startQuiz);
        document.querySelectorAll('.direction-btn').forEach(btn => {
            btn.addEventListener('click', (e) => handleGambling(e.target.dataset.direction));
        });
        document.getElementById('back-to-quiz-btn').addEventListener('click', () => showScreen('quizSelection'));
        document.getElementById('restart-from-quiz-btn').addEventListener('click', () => {
            gameState.chips = 0;
            updateChipDisplay();
            showScreen('quizSelection');
        });

        // --- Initialization ---
        updateChipDisplay();
        handleApiKey();
    });
    </script>
</body>
</html>
